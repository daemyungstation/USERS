<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="DMLCompanysourcingDAO">
	
	<select id="DMLCompanysourcingDAO.selectLdjList" parameterType="emfMap" resultType="emfMap">
	/* DMLCompanysourcingDAO.selectLdjList */
	WITH DAY_RESULT AS 
	(
	    SELECT MPA.ACCNT_NO,
	        PD.SECTION_THR,
	        B2B.SALE_TYPE,
	        MPA.REG_DM,
	        PD.PROD_CD
	    FROM MEM_PROD_ACCNT MPA INNER JOIN
	        PRODUCT PD ON MPA.PROD_CD = PD.PROD_CD AND MPA.DEL_FG = 'N' LEFT OUTER JOIN
	        B2BCOMCD B2B ON MPA.B2B_COMP_CD =  B2B.COM_CD
		WHERE TO_CHAR(MPA.REG_DM,'YYYYMMDD') BETWEEN TO_CHAR(ADD_MONTHS(LAST_DAY(SYSDATE), -1),'YYYYMM') || '01' AND  TO_CHAR(LAST_DAY(SYSDATE),'YYYYMMDD')
	)

	--LGU
	SELECT     
	    'LGU' AS GUBUN,
	    NVL(SUM(CASE WHEN TO_CHAR(REG_DM,'YYYYMMDD') = TO_CHAR(SYSDATE - 1,'YYYYMMDD') THEN 1 ELSE 0 END),0) AS PRE_CNT,
	    NVL(SUM(CASE WHEN TO_CHAR(REG_DM,'YYYYMMDD') = TO_CHAR(SYSDATE,'YYYYMMDD') THEN 1 ELSE 0 END),0) AS NOW_CNT,
	    NVL(SUM(CASE WHEN TO_CHAR(REG_DM, 'YYYYMM') = TO_CHAR(LAST_DAY(SYSDATE),'YYYYMM') THEN 1 ELSE 0 END), 0) AS MON_CNT,
		NVL(SUM(CASE WHEN TO_CHAR(REG_DM, 'YYYYMM') != TO_CHAR(LAST_DAY(SYSDATE),'YYYYMM') THEN 1 ELSE 0 END), 0) AS PRE_MON_CNT
	FROM DAY_RESULT
	WHERE SECTION_THR = '0008'
	
	UNION ALL
	--SDP
	SELECT     
	    'SDP' AS GUBUN,
	    NVL(SUM(CASE WHEN TO_CHAR(REG_DM,'YYYYMMDD') = TO_CHAR(SYSDATE - 1,'YYYYMMDD') THEN 1 ELSE 0 END),0) AS PRE_CNT,
	    NVL(SUM(CASE WHEN TO_CHAR(REG_DM,'YYYYMMDD') = TO_CHAR(SYSDATE,'YYYYMMDD') THEN 1 ELSE 0 END),0) AS NOW_CNT,
	    NVL(SUM(CASE WHEN TO_CHAR(REG_DM, 'YYYYMM') = TO_CHAR(LAST_DAY(SYSDATE),'YYYYMM') THEN 1 ELSE 0 END), 0) AS MON_CNT,
		NVL(SUM(CASE WHEN TO_CHAR(REG_DM, 'YYYYMM') != TO_CHAR(LAST_DAY(SYSDATE),'YYYYMM') THEN 1 ELSE 0 END), 0) AS PRE_MON_CNT
	FROM DAY_RESULT
	WHERE SECTION_THR = '0010'

	UNION ALL
	--CUC(COCKOO)
	SELECT
		'CUC' AS GUBUN,
		NVL(SUM(CASE WHEN TO_CHAR(REG_DM,'YYYYMMDD') = TO_CHAR(SYSDATE - 1,'YYYYMMDD') THEN 1 ELSE 0 END),0) AS PRE_CNT,
		NVL(SUM(CASE WHEN TO_CHAR(REG_DM,'YYYYMMDD') = TO_CHAR(SYSDATE,'YYYYMMDD') THEN 1 ELSE 0 END),0) AS NOW_CNT,
		NVL(SUM(CASE WHEN TO_CHAR(REG_DM, 'YYYYMM') = TO_CHAR(LAST_DAY(SYSDATE),'YYYYMM') THEN 1 ELSE 0 END), 0) AS MON_CNT,
		NVL(SUM(CASE WHEN TO_CHAR(REG_DM, 'YYYYMM') != TO_CHAR(LAST_DAY(SYSDATE),'YYYYMM') THEN 1 ELSE 0 END), 0) AS PRE_MON_CNT
	FROM DAY_RESULT
	WHERE SECTION_THR = '0035'
	
	UNION ALL


	--스페셜라이프
	SELECT
		'SPE' AS GUBUN,
		NVL(SUM(CASE WHEN TO_CHAR(REG_DM,'YYYYMMDD') = TO_CHAR(SYSDATE - 1,'YYYYMMDD') THEN 1 ELSE 0 END),0) AS PRE_CNT,
		NVL(SUM(CASE WHEN TO_CHAR(REG_DM,'YYYYMMDD') = TO_CHAR(SYSDATE,'YYYYMMDD') THEN 1 ELSE 0 END),0) AS NOW_CNT,
		NVL(SUM(CASE WHEN TO_CHAR(REG_DM, 'YYYYMM') = TO_CHAR(LAST_DAY(SYSDATE),'YYYYMM') THEN 1 ELSE 0 END), 0) AS MON_CNT,
		NVL(SUM(CASE WHEN TO_CHAR(REG_DM, 'YYYYMM') != TO_CHAR(LAST_DAY(SYSDATE),'YYYYMM') THEN 1 ELSE 0 END), 0) AS PRE_MON_CNT
	FROM DAY_RESULT
	WHERE SECTION_THR = '0029'

	UNION ALL
	--다이렉트
	SELECT
		'DIR' AS GUBUN,
		NVL(SUM(CASE WHEN TO_CHAR(REG_DM,'YYYYMMDD') = TO_CHAR(SYSDATE - 1,'YYYYMMDD') THEN 1 ELSE 0 END),0) AS PRE_CNT,
		NVL(SUM(CASE WHEN TO_CHAR(REG_DM,'YYYYMMDD') = TO_CHAR(SYSDATE,'YYYYMMDD') THEN 1 ELSE 0 END),0) AS NOW_CNT,
		NVL(SUM(CASE WHEN TO_CHAR(REG_DM, 'YYYYMM') = TO_CHAR(LAST_DAY(SYSDATE),'YYYYMM') THEN 1 ELSE 0 END), 0) AS MON_CNT,
		NVL(SUM(CASE WHEN TO_CHAR(REG_DM, 'YYYYMM') != TO_CHAR(LAST_DAY(SYSDATE),'YYYYMM') THEN 1 ELSE 0 END), 0) AS PRE_MON_CNT
	FROM DAY_RESULT
	WHERE SECTION_THR = '0027'

	UNION ALL
	--홈쇼핑
	SELECT
		'HSP' AS GUBUN,
		NVL(SUM(CASE WHEN TO_CHAR(REG_DM,'YYYYMMDD') = TO_CHAR(SYSDATE - 1,'YYYYMMDD') THEN 1 ELSE 0 END),0) AS PRE_CNT,
		NVL(SUM(CASE WHEN TO_CHAR(REG_DM,'YYYYMMDD') = TO_CHAR(SYSDATE,'YYYYMMDD') THEN 1 ELSE 0 END),0) AS NOW_CNT,
		NVL(SUM(CASE WHEN TO_CHAR(REG_DM, 'YYYYMM') = TO_CHAR(LAST_DAY(SYSDATE),'YYYYMM') THEN 1 ELSE 0 END), 0) AS MON_CNT,
		NVL(SUM(CASE WHEN TO_CHAR(REG_DM, 'YYYYMM') != TO_CHAR(LAST_DAY(SYSDATE),'YYYYMM') THEN 1 ELSE 0 END), 0) AS PRE_MON_CNT
	FROM DAY_RESULT
	WHERE (SECTION_THR = '0002' AND NVL(SALE_TYPE,'9999') IN ('0027', '0012')) OR SECTION_THR = '0020'

	UNION ALL
	--더원라이프
	SELECT
		'ONE' AS GUBUN,
		NVL(SUM(CASE WHEN TO_CHAR(REG_DM,'YYYYMMDD') = TO_CHAR(SYSDATE - 1,'YYYYMMDD') THEN 1 ELSE 0 END),0) AS PRE_CNT,
		NVL(SUM(CASE WHEN TO_CHAR(REG_DM,'YYYYMMDD') = TO_CHAR(SYSDATE,'YYYYMMDD') THEN 1 ELSE 0 END),0) AS NOW_CNT,
		NVL(SUM(CASE WHEN TO_CHAR(REG_DM, 'YYYYMM') = TO_CHAR(LAST_DAY(SYSDATE),'YYYYMM') THEN 1 ELSE 0 END), 0) AS MON_CNT,
		NVL(SUM(CASE WHEN TO_CHAR(REG_DM, 'YYYYMM') != TO_CHAR(LAST_DAY(SYSDATE),'YYYYMM') THEN 1 ELSE 0 END), 0) AS PRE_MON_CNT
	FROM DAY_RESULT
	WHERE SECTION_THR = '0028'

	UNION ALL
	--일반/법인
	SELECT     
	    'ETC' AS GUBUN,
	    NVL(SUM(CASE WHEN TO_CHAR(REG_DM,'YYYYMMDD') = TO_CHAR(SYSDATE - 1,'YYYYMMDD') THEN 1 ELSE 0 END),0) AS PRE_CNT,
	    NVL(SUM(CASE WHEN TO_CHAR(REG_DM,'YYYYMMDD') = TO_CHAR(SYSDATE,'YYYYMMDD') THEN 1 ELSE 0 END),0) AS NOW_CNT,
	    NVL(SUM(CASE WHEN TO_CHAR(REG_DM, 'YYYYMM') = TO_CHAR(LAST_DAY(SYSDATE),'YYYYMM') THEN 1 ELSE 0 END), 0) AS MON_CNT,
		NVL(SUM(CASE WHEN TO_CHAR(REG_DM, 'YYYYMM') != TO_CHAR(LAST_DAY(SYSDATE),'YYYYMM') THEN 1 ELSE 0 END), 0) AS PRE_MON_CNT
	FROM DAY_RESULT
	WHERE SECTION_THR IN ('0012')

	UNION ALL
	--기타온오프(버킷마켓)
	SELECT
		'E03' AS GUBUN,
		NVL(SUM(CASE WHEN TO_CHAR(REG_DM,'YYYYMMDD') = TO_CHAR(SYSDATE - 1,'YYYYMMDD') THEN 1 ELSE 0 END),0) AS PRE_CNT,
		NVL(SUM(CASE WHEN TO_CHAR(REG_DM,'YYYYMMDD') = TO_CHAR(SYSDATE,'YYYYMMDD') THEN 1 ELSE 0 END),0) AS NOW_CNT,
		NVL(SUM(CASE WHEN TO_CHAR(REG_DM, 'YYYYMM') = TO_CHAR(LAST_DAY(SYSDATE),'YYYYMM') THEN 1 ELSE 0 END), 0) AS MON_CNT,
		NVL(SUM(CASE WHEN TO_CHAR(REG_DM, 'YYYYMM') != TO_CHAR(LAST_DAY(SYSDATE),'YYYYMM') THEN 1 ELSE 0 END), 0) AS PRE_MON_CNT
	FROM DAY_RESULT
	WHERE SECTION_THR = '0032'

	UNION ALL

	--후불제
	SELECT     
	    'LAT' AS GUBUN,
	    NVL(SUM(CASE WHEN TO_CHAR(REG_DM,'YYYYMMDD') = TO_CHAR(SYSDATE - 1,'YYYYMMDD') THEN 1 ELSE 0 END),0) AS PRE_CNT,
	    NVL(SUM(CASE WHEN TO_CHAR(REG_DM,'YYYYMMDD') = TO_CHAR(SYSDATE,'YYYYMMDD') THEN 1 ELSE 0 END),0) AS NOW_CNT,
	    NVL(SUM(CASE WHEN TO_CHAR(REG_DM, 'YYYYMM') = TO_CHAR(LAST_DAY(SYSDATE),'YYYYMM') THEN 1 ELSE 0 END), 0) AS MON_CNT,
		NVL(SUM(CASE WHEN TO_CHAR(REG_DM, 'YYYYMM') != TO_CHAR(LAST_DAY(SYSDATE),'YYYYMM') THEN 1 ELSE 0 END), 0) AS PRE_MON_CNT
	FROM DAY_RESULT
	WHERE PROD_CD IN ( 'DL','OC','KZ','LA' )
	
	UNION ALL

	--전체
	SELECT     
	    'TOT' AS GUBUN,
	    NVL(SUM(CASE WHEN TO_CHAR(REG_DM,'YYYYMMDD') = TO_CHAR(SYSDATE - 1,'YYYYMMDD') THEN 1 ELSE 0 END),0) AS PRE_CNT,
	    NVL(SUM(CASE WHEN TO_CHAR(REG_DM,'YYYYMMDD') = TO_CHAR(SYSDATE,'YYYYMMDD') THEN 1 ELSE 0 END),0) AS NOW_CNT,
	    NVL(SUM(CASE WHEN TO_CHAR(REG_DM, 'YYYYMM') = TO_CHAR(LAST_DAY(SYSDATE),'YYYYMM') THEN 1 ELSE 0 END), 0) AS MON_CNT,
		NVL(SUM(CASE WHEN TO_CHAR(REG_DM, 'YYYYMM') != TO_CHAR(LAST_DAY(SYSDATE),'YYYYMM') THEN 1 ELSE 0 END), 0) AS PRE_MON_CNT
	FROM DAY_RESULT
		

	</select>
	
	<select id="DMLCompanysourcingDAO.selectEisList" parameterType="emfMap" resultType="emfMap">
	
        SELECT * FROM WEB_EIS_LIST_VIEW
	
	</select>
	
	<select id="DMLCompanysourcingDAO.select_SDP_CHECK_List" parameterType="emfMap" resultType="emfMap">
		SELECT /* DMLCompanysourcingDAO.select_SDP_CHECK_List */
			   CASE WHEN TBL.TOT_CNT <![CDATA[<]]> 1 THEN '01'
			   		WHEN TBL.ACC_STAT = '행사' THEN '00'
			   		WHEN TBL.ACC_STAT = '정상' AND TBL.TRUE_CNT <![CDATA[>]]> 0 THEN '00' || TO_CHAR(TO_DATE(TBL.JOIN_DT, 'yyyyMMdd'), 'yyyy-MM')
			   		WHEN TBL.ACC_STAT = '정상' AND TBL.TRUE_CNT <![CDATA[<]]> 1 THEN '01'
			   		WHEN FN_COM_NM('81', TBL.STAT) = '철회' THEN '01'
			   	    WHEN TBL.ACC_STAT = '해약' OR TBL.ACC_STAT = '청약철회' THEN '02'
			   		ELSE '07' 
			   		 END RET
		FROM (
			SELECT COUNT(*) OVER() AS TOT_CNT
			       , B.JOIN_DT
				   , (SELECT COUNT(SEQ) FROM PAY_MNG WHERE DEL_FG = 'N' AND ACCNT_NO = B.ACCNT_NO) AS TRUE_CNT
				   , DECODE(FN_ACCNT_STAT(B.ACCNT_NO), 'Y', '정상', 'R', '해약', 'E', '행사', '청약철회') AS ACC_STAT
				   , D.STAT
			  FROM MEMBER A, MEM_PROD_ACCNT B, PRODUCT C, HP_CALL D
			 WHERE A.MEM_NO = B.MEM_NO
			   AND B.PROD_CD = C.PROD_CD
			   AND B.ACCNT_NO = D.ACCNT_NO(+)
			   AND A.DEL_FG = 'N'
			   AND B.DEL_FG = 'N'
			   AND A.MEM_NM = #{name1}
			   AND SUBSTR(A.CELL, -4) = #{phone1}
		) TBL
	</select>
	
	<select id="DMLCompanysourcingDAO.select_THEONE_CHECK_List" parameterType="emfMap" resultType="emfMap">
		SELECT /* DMLCompanysourcingDAO.select_THEONE_CHECK_List */
			   CASE WHEN TBL.TOT_CNT <![CDATA[<]]> 1 THEN '01'
			   		WHEN TBL.ACC_STAT = '행사' THEN '00'
			   		WHEN TBL.ACC_STAT = '정상' AND TBL.TRUE_CNT <![CDATA[>]]> 0 THEN '00' || TO_CHAR(TO_DATE(TBL.JOIN_DT, 'yyyyMMdd'), 'yyyy-MM')
			   		WHEN TBL.ACC_STAT = '정상' AND TBL.TRUE_CNT <![CDATA[<]]> 1 THEN '01'
			   		WHEN FN_COM_NM('81', TBL.STAT) = '철회' THEN '01'
			   	    WHEN TBL.ACC_STAT = '해약' OR TBL.ACC_STAT = '청약철회' THEN '02'
			   		ELSE '07' 
			   		 END RET
		FROM (
			SELECT COUNT(*) OVER() AS TOT_CNT
			       , B.JOIN_DT
				   , (SELECT COUNT(SEQ) FROM PAY_MNG WHERE DEL_FG = 'N' AND ACCNT_NO = B.ACCNT_NO) AS TRUE_CNT
				   , DECODE(FN_ACCNT_STAT(B.ACCNT_NO), 'Y', '정상', 'R', '해약', 'E', '행사', '청약철회') AS ACC_STAT
				   , D.STAT
			  FROM MEMBER A, MEM_PROD_ACCNT B, PRODUCT C, HP_CALL D
			 WHERE A.MEM_NO = B.MEM_NO
			   AND B.PROD_CD = C.PROD_CD
			   AND B.PROD_CD IN ('DO', 'EI', 'EJ', 'DN', 'FF', 'FG', 'FH', 'FI', 'FJ', 'FK', 'GA', 'GB', 'HN', 'HO', 'HP', 'HQ', 'HR', 'HS', 'FL', 'GI', 'GJ', 'GK', 'GL', 'HZ', 'IA', 'IB', 'IC', 'ID', 
			   	'MR', 'MU', 'MV', 'MS', 'MT', 'MW', 'MA', 'MB', 'HZ', 'MI', 'ME', 'MF', 'MG', 'MH')
			   AND B.ACCNT_NO = D.ACCNT_NO(+)
			   AND A.DEL_FG = 'N'
			   AND B.DEL_FG = 'N'
			   AND A.MEM_NM = #{name1}
			   AND SUBSTR(A.CELL, -4) = #{phone1}
		) TBL
	</select>
	
	<select id="DMLCompanysourcingDAO.selectLdj_Event_List" parameterType="emfMap" resultType="emfMap">
	
		SELECT
            ACCNT_NO, 
            SUBSTR(MEM_NM,1,1) || '*' || SUBSTR(MEM_NM,3,1) AS MEM_NM, 
            (SUBSTR(CELL,1,8)) || '****' AS CELL,
            SUBSTR(BIRTH,3,4) || '**' AS BIRTH,
            PROD_NM,
            NVL(TRUE_CNT,0) AS TRUE_CNT,
	       (NVL(PAY_AMT,0) + NVL(REL_AMT,0) + NVL(ADD_AMT,0)) AS TOT_AMT,
	       (NVL(PT_AMT,0) - NVL(PAY_AMT,0)) AS DIFFA_AMT,
	       (NVL(PR_AMT,0) - NVL(REL_AMT,0)) AS DIFFB_AMT,
	       (NVL(PA_AMT,0) - NVL(ADD_AMT,0)) AS DIFFC_AMT,
	       (NVL(PT_AMT,0) + NVL(PR_AMT,0) + NVL(PA_AMT,0)) - (NVL(PAY_AMT,0) + NVL(REL_AMT,0) + NVL(ADD_AMT,0)) AS DIFF_AMT
        FROM
        (
            SELECT 
                MPA.ACCNT_NO, 
                MEM_NM , 
                MB.CELL,
                MB.BRTH_MON_DAY as BIRTH,
                PD.PROD_NM,
                MPA.NEW_CHAN_GUNSU,
                PD.EXPR_NO,
                (SELECT COUNT(NO) FROM LF_DMUSER.PAY_MNG WHERE ACCNT_NO = MPA.ACCNT_NO AND DEL_FG = 'N' AND NO <![CDATA[<=]]> (EXPR_NO - NEW_CHAN_GUNSU)) AS TRUE_CNT,
                (SELECT SUM(PAY_AMT) FROM LF_DMUSER.PAY_MNG WHERE ACCNT_NO = MPA.ACCNT_NO AND DEL_FG = 'N') AS PAY_AMT,
                (SELECT SUM(PAY_AMT) FROM LF_DMUSER.PAY_MNG_DTL WHERE ACCNT_NO = MPA.ACCNT_NO AND DEL_FG = 'N') AS REL_AMT,
                (SELECT SUM(PAY_AMT) FROM LF_DMUSER.PAY_MNG_DTL1 WHERE ACCNT_NO = MPA.ACCNT_NO AND DEL_FG = 'N') AS ADD_AMT,
                (SELECT SUM(AMT) FROM PRODUCT_NO_DATA WHERE PROD_CD = MPA.PROD_CD  AND NO <![CDATA[<=]]> (EXPR_NO - NEW_CHAN_GUNSU)) AS PT_AMT,
                (SELECT SUM(REL_AMT) FROM PRODUCT_NO_DATA WHERE PROD_CD = MPA.PROD_CD) AS PR_AMT,
                (SELECT SUM(ADD_AMT) FROM PRODUCT_NO_DATA WHERE PROD_CD = MPA.PROD_CD) AS PA_AMT
            FROM LF_DMUSER.MEM_PROD_ACCNT MPA INNER JOIN
                LF_DMUSER.MEMBER MB ON MPA.MEM_NO = MB.MEM_NO INNER JOIN
                LF_DMUSER.PRODUCT PD ON MPA.PROD_CD = PD.PROD_CD
            WHERE 1=1
            <if test="name!=null and !name.equals('')">
				AND MB.MEM_NM = #{name, jdbcType=VARCHAR}
			</if>
			<if test="cell!=null and !cell.equals('')">
				AND REPLACE(CELL,'-','') = REPLACE(#{cell, jdbcType=VARCHAR},'-','')
			</if>			            	            	
        ) TBL
	</select>	
	
	<select id="DMLCompanysourcingDAO.selectLdj_Tour_List" parameterType="emfMap" resultType="emfMap">
	<![CDATA[
		SELECT MB.MEM_NM,
		    (TO_CHAR(SUBSTR(MB.CELL,1,3)) || '-****-' || TO_CHAR(SUBSTR(MB.CELL,-4))) AS CELL,
		    MPA.JOIN_DT
		FROM MEM_PROD_ACCNT MPA INNER JOIN
		    MEMBER MB ON MPA.MEM_NO = MB.MEM_NO AND MPA.DEL_FG = 'N'
		WHERE MPA.ACCNT_NO =  #{accntno, jdbcType=VARCHAR}   
        ]]>
	</select>		
	
	<select id="DMLCompanysourcingDAO.selectChkReqnCnt" parameterType="emfMap" resultType="java.lang.Integer">
		SELECT /* DMLCompanysourcingDAO.selectChkReqnCnt */ 
		       COUNT(*)
		  FROM DJ_TEST
		 WHERE USER_NM = #{name}
	</select>
	
	<select id="DMLCompanysourcingDAO.selectResnProtectList" parameterType="emfMap" resultType="emfMap">

		SELECT
			/* DMLCompanysourcingDAO.selectResnProtectList */
		   RESN_DAY,
	       RESN_WK,
	       (PROC_N + PROC_Y + RETURN_CNT) AS TOT_CNT,
	       RETURN_CNT,
	       ROUND(RETURN_CNT / (PROC_N + PROC_Y + RETURN_CNT),3) * 100 AS RETURN_PC,      
	       PROC_Y,
	       PROC_N  
		FROM
		(
		    SELECT
		        RESN_ACPT_DAY AS RESN_DAY,
                TO_CHAR(TO_DATE(RESN_ACPT_DAY), 'dy') AS RESN_WK,                
		        SUM(CASE WHEN NVL(RESN_PROC_YN,'N') = 'N' AND DEL_FG = 'N' THEN 1 ELSE 0 END) AS PROC_N,
		        SUM(CASE WHEN NVL(RESN_PROC_YN,'N') = 'Y' AND DEL_FG = 'N' THEN 1 ELSE 0 END) AS PROC_Y,
		        SUM(CASE WHEN KSTBIT = '02' THEN 1 ELSE 0 END) AS RETURN_CNT
		    FROM
		    (
		        SELECT 
		            RS.ACCNT_NO,
		            RS.RESN_ACPT_DAY,                    
		            RS.RESN_PROC_YN,
		            RS.RESON,
		            RS.DEL_FG,
		            MPA.KSTBIT,
                    CASE WHEN LENGTH(NVL(MB.IDN_NO,'N')) = 10 THEN 'Y' ELSE 'N' END AS COMP_YN,
                    FN_GET_MANDAY(RS.ACCNT_NO,MPA.JOIN_DT, PD.EXPR_NO, MPA.NEW_CHAN_GUNSU, 'NEW') AS MAN_DAY
		        FROM RESCISSION RS INNER JOIN
		            MEM_PROD_ACCNT MPA ON RS.ACCNT_NO = MPA.ACCNT_NO AND MPA.DEL_FG = 'N' INNER JOIN
                    MEMBER MB ON MPA.MEM_NO = MB.MEM_NO AND MB.DEL_FG = 'N' INNER JOIN
                    PRODUCT PD ON MPA.PROD_CD = PD.PROD_CD
		        WHERE RESN_ACPT_DAY BETWEEN TO_CHAR(SYSDATE,'YYYYMM') || '01' AND TO_CHAR(LAST_DAY(SYSDATE),'YYYYMMDD')
		        AND RESON = '23'
		)
        WHERE 1=1
            AND COMP_YN = 'N' 
            AND MAN_DAY <![CDATA[<]]> SYSDATE
		GROUP BY RESN_ACPT_DAY
		)
		ORDER BY RESN_DAY ASC   
	</select>	

</mapper>            



